\hypertarget{qbereg_8h}{
\section{qbereg.h Dateireferenz}
\label{qbereg_8h}\index{qbereg.h@{qbereg.h}}
}


\subsection*{Makrodefinitionen}
\begin{CompactItemize}
\item 
\#define \hyperlink{qbereg_8h_a0}{UNICODE}
\item 
\#define \hyperlink{qbereg_8h_a1}{\_\-UNICODE}
\end{CompactItemize}
\subsection*{Funktionen}
\begin{CompactItemize}
\item 
int \hyperlink{qbereg_8h_a2}{qbe\_\-registry\_\-autologonuser} (LPWSTR sz\-Username, LPWSTR sz\-Password)
\item 
int \hyperlink{qbereg_8h_a3}{qbe\_\-registry\_\-clearautologon} ()
\end{CompactItemize}


\subsection{Makro-Dokumentation}
\hypertarget{qbereg_8h_a1}{
\index{qbereg.h@{qbereg.h}!_UNICODE@{\_\-UNICODE}}
\index{_UNICODE@{\_\-UNICODE}!qbereg.h@{qbereg.h}}
\subsubsection[\_\-UNICODE]{\setlength{\rightskip}{0pt plus 5cm}\#define \_\-UNICODE}}
\label{qbereg_8h_a1}




Definiert in Zeile 3 der Datei qbereg.h.\hypertarget{qbereg_8h_a0}{
\index{qbereg.h@{qbereg.h}!UNICODE@{UNICODE}}
\index{UNICODE@{UNICODE}!qbereg.h@{qbereg.h}}
\subsubsection[UNICODE]{\setlength{\rightskip}{0pt plus 5cm}\#define UNICODE}}
\label{qbereg_8h_a0}




Definiert in Zeile 2 der Datei qbereg.h.

\subsection{Dokumentation der Funktionen}
\hypertarget{qbereg_8h_a2}{
\index{qbereg.h@{qbereg.h}!qbe_registry_autologonuser@{qbe\_\-registry\_\-autologonuser}}
\index{qbe_registry_autologonuser@{qbe\_\-registry\_\-autologonuser}!qbereg.h@{qbereg.h}}
\subsubsection[qbe\_\-registry\_\-autologonuser]{\setlength{\rightskip}{0pt plus 5cm}int qbe\_\-registry\_\-autologonuser (LPWSTR {\em sz\-Username}, LPWSTR {\em sz\-Password})}}
\label{qbereg_8h_a2}




Definiert in Zeile 15 der Datei qbereg.c.

Wird benutzt von Wlx\-Logged\-Out\-SAS().



\footnotesize\begin{verbatim}16 {
17   HKEY hKey;
18   int rc = -1;
19 
20   if (RegCreateKeyEx(HKEY_LOCAL_MACHINE,TEXT("SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon"),0,NULL,REG_OPTION_NON_VOLATILE,KEY_ALL_ACCESS,NULL,&hKey,NULL) == ERROR_SUCCESS)
21   {
22     rc = 0;
23     if ( (rc==0) && (RegSetValueEx(hKey,TEXT("AutoAdminLogon"),0,REG_SZ, (const BYTE*)(L"1"), wcslen(L"1")*sizeof(WCHAR)) != ERROR_SUCCESS))
24       rc = -2;
25     if ( (rc==0) && (RegSetValueEx(hKey,TEXT("DefaultUserName"),0,REG_SZ,(const BYTE*)szUsername, wcslen(szUsername)*sizeof(WCHAR)) != ERROR_SUCCESS))
26       rc = -3;
27     if ( (rc==0) && (RegSetValueEx(hKey,TEXT("DefaultPassword"),0,REG_SZ, (const BYTE*)szPassword, wcslen(szPassword)*sizeof(WCHAR)) != ERROR_SUCCESS))
28       rc = -4;
29     if ( (rc==0) && (RegSetValueEx(hKey,TEXT("ForceAutoLogon"),0,REG_SZ, (const BYTE*)(L"1"), wcslen(L"1")*sizeof(WCHAR)) != ERROR_SUCCESS))
30       rc = -5;
31 
32     // ch:
33     // I dont change the DefaultDomain here, so one can 
34     // pre-set it in the registry. This makes life a bit
35     // easier for those who want a user-auth to another
36     // domain too. But I don't know if this works.
37     //
38     // Also it makes life easier for me, cause I don't
39     // have to read the computer name :>
40   }
41   
42   RegFlushKey(hKey);
43   RegCloseKey(hKey);
44   return rc;
45 }
\end{verbatim}\normalsize 
\hypertarget{qbereg_8h_a3}{
\index{qbereg.h@{qbereg.h}!qbe_registry_clearautologon@{qbe\_\-registry\_\-clearautologon}}
\index{qbe_registry_clearautologon@{qbe\_\-registry\_\-clearautologon}!qbereg.h@{qbereg.h}}
\subsubsection[qbe\_\-registry\_\-clearautologon]{\setlength{\rightskip}{0pt plus 5cm}int qbe\_\-registry\_\-clearautologon ()}}
\label{qbereg_8h_a3}




Definiert in Zeile 47 der Datei qbereg.c.

Wird benutzt von Wlx\-Logged\-Out\-SAS() und Wlx\-Logoff().



\footnotesize\begin{verbatim}48 {
49   HKEY hKey;
50   int rc = -1;
51 
52   if (RegCreateKeyEx(HKEY_LOCAL_MACHINE,TEXT("SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon"),0,NULL,REG_OPTION_NON_VOLATILE,KEY_ALL_ACCESS,NULL,&hKey,NULL) == ERROR_SUCCESS)
53   {
54     rc = 0;
55     RegSetValueEx(hKey,TEXT("AutoAdminLogon"),0,REG_SZ, (const BYTE*)(L"0"), wcslen(L"0")*sizeof(WCHAR));
56     RegDeleteValue( hKey, TEXT("DefaultUserName") );
57     RegDeleteValue( hKey, TEXT("DefaultPassword") );
58     RegDeleteValue( hKey, TEXT("ForceAutoLogon") );
59   }
60   
61   RegFlushKey(hKey);
62   RegCloseKey(hKey);
63   return rc;
64 }
\end{verbatim}\normalsize 
