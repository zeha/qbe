\hypertarget{classQbeSAS_1_1WinServiceAPI}{
\section{Win\-Service\-API Klassenreferenz}
\label{classQbeSAS_1_1WinServiceAPI}\index{QbeSAS::WinServiceAPI@{QbeSAS::WinServiceAPI}}
}


\subsection{Ausf\"{u}hrliche Beschreibung}
\hyperlink{classQbeSAS_1_1WinServiceAPI}{Win\-Service\-API} stellt Routinen zur Verwaltung des Qbe\-Svc unter Windows zur Verfuegung. In der aktuellen Version ist nur \hyperlink{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPIe0}{Remove\-Service()} vorhanden. 



Definiert in Zeile 8 der Datei Win\-Service\-API.cs.\subsection*{\"{O}ffentliche, statische Methoden}
\begin{CompactItemize}
\item 
bool \hyperlink{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPIe0}{Remove\-Service} ()
\end{CompactItemize}
\subsection*{Private Methoden}
\begin{CompactItemize}
\item 
int \hyperlink{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId0}{Open\-SCManager} (string Machine\-Name, string Database\-Name, int dw\-Desired\-Access)
\item 
int \hyperlink{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId1}{Open\-Service} (int h\-SCManager, string lp\-Service\-Name, int dw\-Desired\-Access)
\item 
int \hyperlink{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId2}{Control\-Service} (int h\-Service, int action,\mbox{[}Out, Marshal\-As(System.Runtime.Interop\-Services.Unmanaged\-Type.LPStruct)\mbox{]} \hyperlink{classQbeSAS_1_1WinServiceAPI_1_1SERVICE__STATUS}{SERVICE\_\-STATUS} status)
\item 
int \hyperlink{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId3}{Query\-Service\-Status} (int h\-Service,\mbox{[}Out, Marshal\-As(System.Runtime.Interop\-Services.Unmanaged\-Type.LPStruct)\mbox{]} \hyperlink{classQbeSAS_1_1WinServiceAPI_1_1SERVICE__STATUS}{SERVICE\_\-STATUS} status)
\item 
int \hyperlink{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId4}{Delete\-Service} (int h\-Service)
\item 
int \hyperlink{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId5}{Close\-Service\-Handle} (int h\-Service)
\end{CompactItemize}


\subsection{Dokumentation der Elementfunktionen}
\hypertarget{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId5}{
\index{QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}!CloseServiceHandle@{CloseServiceHandle}}
\index{CloseServiceHandle@{CloseServiceHandle}!QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}}
\subsubsection[CloseServiceHandle]{\setlength{\rightskip}{0pt plus 5cm}int Close\-Service\-Handle (int {\em h\-Service})\hspace{0.3cm}{\tt  \mbox{[}private\mbox{]}}}}
\label{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId5}




Wird benutzt von Win\-Service\-API::Remove\-Service().\hypertarget{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId2}{
\index{QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}!ControlService@{ControlService}}
\index{ControlService@{ControlService}!QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}}
\subsubsection[ControlService]{\setlength{\rightskip}{0pt plus 5cm}int Control\-Service (int {\em h\-Service}, int {\em action}, \mbox{[}Out, Marshal\-As(System.Runtime.Interop\-Services.Unmanaged\-Type.LPStruct)\mbox{]} \hyperlink{classQbeSAS_1_1WinServiceAPI_1_1SERVICE__STATUS}{SERVICE\_\-STATUS} {\em status})\hspace{0.3cm}{\tt  \mbox{[}private\mbox{]}}}}
\label{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId2}




Wird benutzt von Win\-Service\-API::Remove\-Service().\hypertarget{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId4}{
\index{QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}!DeleteService@{DeleteService}}
\index{DeleteService@{DeleteService}!QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}}
\subsubsection[DeleteService]{\setlength{\rightskip}{0pt plus 5cm}int Delete\-Service (int {\em h\-Service})\hspace{0.3cm}{\tt  \mbox{[}private\mbox{]}}}}
\label{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId4}




Wird benutzt von Win\-Service\-API::Remove\-Service().\hypertarget{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId0}{
\index{QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}!OpenSCManager@{OpenSCManager}}
\index{OpenSCManager@{OpenSCManager}!QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}}
\subsubsection[OpenSCManager]{\setlength{\rightskip}{0pt plus 5cm}int Open\-SCManager (string {\em Machine\-Name}, string {\em Database\-Name}, int {\em dw\-Desired\-Access})\hspace{0.3cm}{\tt  \mbox{[}private\mbox{]}}}}
\label{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId0}




Wird benutzt von Win\-Service\-API::Remove\-Service().\hypertarget{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId1}{
\index{QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}!OpenService@{OpenService}}
\index{OpenService@{OpenService}!QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}}
\subsubsection[OpenService]{\setlength{\rightskip}{0pt plus 5cm}int Open\-Service (int {\em h\-SCManager}, string {\em lp\-Service\-Name}, int {\em dw\-Desired\-Access})\hspace{0.3cm}{\tt  \mbox{[}private\mbox{]}}}}
\label{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId1}




Wird benutzt von Win\-Service\-API::Remove\-Service().\hypertarget{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId3}{
\index{QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}!QueryServiceStatus@{QueryServiceStatus}}
\index{QueryServiceStatus@{QueryServiceStatus}!QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}}
\subsubsection[QueryServiceStatus]{\setlength{\rightskip}{0pt plus 5cm}int Query\-Service\-Status (int {\em h\-Service}, \mbox{[}Out, Marshal\-As(System.Runtime.Interop\-Services.Unmanaged\-Type.LPStruct)\mbox{]} \hyperlink{classQbeSAS_1_1WinServiceAPI_1_1SERVICE__STATUS}{SERVICE\_\-STATUS} {\em status})\hspace{0.3cm}{\tt  \mbox{[}private\mbox{]}}}}
\label{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPId3}




Wird benutzt von Win\-Service\-API::Remove\-Service().\hypertarget{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPIe0}{
\index{QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}!RemoveService@{RemoveService}}
\index{RemoveService@{RemoveService}!QbeSAS::WinServiceAPI@{Qbe\-SAS::Win\-Service\-API}}
\subsubsection[RemoveService]{\setlength{\rightskip}{0pt plus 5cm}bool Remove\-Service ()\hspace{0.3cm}{\tt  \mbox{[}static\mbox{]}}}}
\label{classQbeSAS_1_1WinServiceAPI_QbeSAS_1_1WinServiceAPIe0}


Stoppt und entfernt den Qbe\-Svc. Dazu sind Administratorrechte erforderlich. 

Definiert in Zeile 37 der Datei Win\-Service\-API.cs.

Benutzt Win\-Service\-API::Close\-Service\-Handle(), Win\-Service\-API::Control\-Service(), Win\-Service\-API::Delete\-Service(), Win\-Service\-API::SERVICE\_\-STATUS::dw\-Current\-State, Win\-Service\-API::Open\-SCManager(), Win\-Service\-API::Open\-Service(), Win\-Service\-API::Query\-Service\-Status() und ss\-Status.



\footnotesize\begin{verbatim}38     {
39       int schService;
40       int schSCManager;
41       SERVICE_STATUS ssStatus = new SERVICE_STATUS();
42 
43       int accessManagerConnect = 0x0001;
44       int accessServiceDelete = 0x00010000;
45       int accessServiceStop = 0x0020;
46       int accessServiceQueryStatus = 0x0004;
47 
48       int controlServiceStop = 0x01;
49       int serviceStopPending = 0x00000003;
50 
51       // ServiceControl Manager oeffnen
52       schSCManager = OpenSCManager( null, null, accessManagerConnect );
53 
54       if ( schSCManager != 0 )
55       {
56         // Service oeffnen
57         schService = OpenService(schSCManager, "qbesvc", accessServiceDelete | accessServiceStop | accessServiceQueryStatus);
58 
59         if (schService != 0 )
60         {
61           // try to stop the service
62           if ( ControlService( schService, controlServiceStop, ssStatus ) != 0 )
63           {
64             System.Threading.Thread.Sleep( 1000 );
65             while ( QueryServiceStatus( schService, ssStatus ) != 0 )
66             {
67               if ( ssStatus.dwCurrentState == serviceStopPending )
68                 System.Threading.Thread.Sleep( 1000 );
69                             else
70                 break;
71             }
72           }
73 
74           DeleteService(schService);
75           CloseServiceHandle(schService);
76                 }
77         CloseServiceHandle(schSCManager);
78         return true;
79       } 
80       else 
81         return false;
82 
83     }
\end{verbatim}\normalsize 
